<div class="the-thing-editor" *ngIf="theThing">
  <form [formGroup]="formGroup">
    <ygg-action-bar-layout
      ><div ygg-action-bar-button>
        <button type="button" mat-fab class="submit" (click)="onSubmit()">
          <mat-icon>save</mat-icon>
        </button>
      </div>
      <div ygg-action-bar-content>
        <div class="meta">
          <br />
          <ygg-tags-control
            label="這東東是...（標籤）"
            taggableType="the-thing"
            class="tags"
            formControlName="tags"
          ></ygg-tags-control>
          <br />
          <mat-form-field class="name">
            <input matInput placeholder="這東東叫做...（名稱）" formControlName="name" />
          </mat-form-field>
          <br />
          <mat-form-field class='imitation'>
            <select
              matNativeControl
              placeholder="這東東是個...（類型）"
              [formControl]="formControlImitation"
            >
              <option
                *ngFor="let imitation of imitations | keyvalue"
                [value]="imitation.key"
              >
                {{ imitation.value.name }}
              </option>
            </select>
          </mat-form-field>
        </div>
        <div class="add-cell">
          <ygg-title-divider>新增資料欄位</ygg-title-divider>
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
            <div class="tags">
              <mat-form-field>
                <select
                  matNativeControl
                  placeholder="資料欄位型態"
                  [formControl]="formControlNewCellType"
                  required
                >
                  <option
                    *ngFor="let cellType of cellTypes | keyvalue"
                    [value]="cellType.key"
                  >
                    {{ cellType.value.label }}
                  </option>
                </select>
              </mat-form-field>
            </div>
            <div class="name">
              <mat-form-field>
                <input
                  matInput
                  placeholder="資料欄位名稱"
                  [formControl]="formControlNewCellName"
                  required
                />
              </mat-form-field>
            </div>
            <div>
              <button
                type="button"
                mat-mini-fab
                matTooltip="新增資料欄位"
                (click)="addCell()"
                [disabled]="
                  !(
                    formControlNewCellName.valid && formControlNewCellType.valid
                  )
                "
              >
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>
        </div>
        <div class="cell-controls">
          <div *ngFor="let cellItem of theThing.cells | keyvalue">
            <div [attr.cell-name]="cellItem.key">
              <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px">
                <button
                  class="delete"
                  mat-fab
                  (click)="deleteCell(cellItem.value)"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
              <the-thing-cell-control
                [cell]="cellItem.value"
                [formGroup]="cellsFormGroup"
              ></the-thing-cell-control>
            </div>
          </div>
          <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px">
            <button class="delete-all" mat-fab (click)="deleteAllCells()">
              <mat-icon>delete_sweep</mat-icon>
            </button>
          </div>
        </div>
        <div class="relations">
          <ygg-title-divider>關聯其他東東</ygg-title-divider>
          <div class="add-relation">
            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
              <div>
                <mat-form-field>
                  <input
                    type="text"
                    matInput
                    [formControl]="formControlNewRelationName"
                    class="relation-name"
                  />
                </mat-form-field>
                <!-- <mat-autocomplete>
        <mat-option *ngFor="let name of relationNames" [value]="name">
        {{ name }}
        </mat-option>
        </mat-autocomplete> -->
              </div>
              <div>
                <button
                  type="button"
                  mat-mini-fab
                  class="the-thing-create"
                  (click)="gotoCreateRelationObject()"
                  [disabled]="isNewRelationNameEmpty"
                >
                  <mat-icon>post_add</mat-icon>
                </button>
                <button
                  type="button"
                  mat-mini-fab
                  class="the-thing-finder"
                  (click)="openTheThingFinder()"
                  [disabled]="isNewRelationNameEmpty"
                >
                  <mat-icon>search</mat-icon>
                </button>
              </div>
            </div>
          </div>
          <div class="relation-list">
            <div
              *ngFor="let relation of theThing.relations | keyvalue"
              [attr.relation-name]="relation.key"
            >
              <h3>{{ relation.key }}</h3>
              <the-thing-list
                [ids]="relation.value"
                (delete)="onDeleteRelation(relation.key, $event)"
              ></the-thing-list>
            </div>
          </div>
        </div></div
    ></ygg-action-bar-layout>
  </form>
</div>
