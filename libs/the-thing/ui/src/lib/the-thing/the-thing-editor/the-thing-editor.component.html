<div class="the-thing-editor" *ngIf="theThing">
  <form [formGroup]="formGroup">
    <ygg-action-bar-layout>
      <div ygg-action-bar-button [hidden]="!hasImitations">
        <button
          type="button"
          mat-fab
          class="open-imitations"
          (click)="applyTemplate()"
          matTooltip="套用範本"
        >
          <mat-icon>library_books</mat-icon>
        </button>
      </div>
      <div ygg-action-bar-button>
        <button
          type="button"
          mat-fab
          class="submit"
          (click)="onSubmit()"
          [disabled]="formGroup.invalid || inProgressing"
          matTooltip="新增/修改"
        >
          <mat-icon>save</mat-icon>
        </button>
      </div>
      <div ygg-action-bar-content>
        <div
          *ngIf="relationCreation"
          class="relation-create-hint"
          fxLayout="row"
          fxLayoutAlign="start center"
          fxLayoutGap="10px"
        >
          <h4>
            <mat-icon>call_merge</mat-icon>
            關聯物件：{{ relationCreation.relationName }} →
            {{ relationCreation.subject.name }}
          </h4>
          <button
            type="button"
            class="cancel"
            mat-mini-fab
            (click)="cancelCreateRelation()"
            matTooltip="取消關聯，回前一物件"
          >
            <mat-icon>cancel</mat-icon>
          </button>
        </div>
        <div class="meta">
          <br />
          <ygg-tags-control
            label="這東東是...（標籤）"
            taggableType="the-thing"
            class="tags"
            formControlName="tags"
          ></ygg-tags-control>
          <br />
          <mat-form-field class="name">
            <input
              matInput
              placeholder="這東東叫做...（名稱）"
              formControlName="name"
            />
          </mat-form-field>
          <br />
          <mat-form-field>
            <select
              class="view"
              matNativeControl
              placeholder="資料顯示為...（樣版）"
              formControlName="view"
            >
              <option *ngFor="let view of views | keyvalue" [value]="view.key">
                {{ view.value.label }}
              </option>
            </select>
          </mat-form-field>
        </div>
        <div class="cells-editor">
          <the-thing-cells-editor
            [formControl]="formControlCells"
          ></the-thing-cells-editor>
        </div>
        <div class="relations-editors">
          <ygg-title-divider [level]='2'>其他東東關聯</ygg-title-divider>
          <form [formGroup]="formGroupRelations">
            <div
              *ngFor="
                let controlEntry of formGroupRelations.controls | keyvalue
              "
              [attr.relation-name]="controlEntry.key"
            >
              <ygg-title-divider [level]='6'>{{ controlEntry.key }}</ygg-title-divider>
              <the-thing-relations-editor
                [name]="controlEntry.key"
                [formControlName]="controlEntry.key"
                [subject]="theThing"
                (createObject)="gotoCreateRelationObject(controlEntry.key)"
              ></the-thing-relations-editor>
            </div>
          </form>
          <br /><br />
          <div class="add-relation">
            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
              <div>
                <mat-form-field>
                  <input
                    type="text"
                    matInput
                    [formControl]="formControlNewRelationName"
                    class="relation-name"
                    placeholder="新增關聯"
                  />
                </mat-form-field>
              </div>
              <div>
                <button
                  [disabled]="!formControlNewRelationName.value"
                  mat-mini-fab
                  (click)="onAddNewRelation()"
                  class="add-relation"
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div></ygg-action-bar-layout
    >
  </form>
</div>
