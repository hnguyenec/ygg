<div class="tour-plan-builder" *ngIf="theThing">
  <mat-horizontal-stepper linear #stepper>
    <mat-step [stepControl]="firstFormGroup">
      <div step="1" class="step1">
        <div
          fxLayout="row"
          fxLayoutAlign="space-between center"
          fxLayoutGap="10px"
        >
          <div>
            <h2>開始您的遊程規劃</h2>
          </div>
          <div>
            <button
              mat-fab
              class="next"
              matStepperNext
              [disabled]="firstFormGroup.invalid"
              matTooltip="下一步"
              (click)="updateTourPlan()"
            >
              <mat-icon>navigate_next</mat-icon>
            </button>
          </div>
        </div>
        <form [formGroup]="firstFormGroup">
          <div
            fxLayout="row wrap"
            fxLayoutAlign="start start"
            fxLayoutGap="50px"
          >
            <div class="date-range">
              <ygg-date-range-control
                label="預計出遊日期"
                formControlName="dateRange"
              ></ygg-date-range-control>
              <br />
            </div>
            <div class="num-participants">
              <ygg-number-control
                label="預計參加人數"
                formControlName="numParticipants"
                [min]='1'
                [max]='200'
                required
              ></ygg-number-control>
            </div>
          </div>
          <br />
          <div class="play-list">
            <h4>選擇想要參加的體驗</h4>
            <the-thing-finder
              [filter]="filterPlays"
              hideFilter
              formControlName='selectedPlays'
            ></the-thing-finder>
          </div>
        </form>
      </div>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
      <div step="2" class="step2">
        <div
          fxLayout="row"
          fxLayoutAlign="space-between center"
          fxLayoutGap="10px"
        >
          <div>
            <button
              type="button"
              mat-fab
              class="previous"
              matStepperPrevious
              matTooltip="上一步"
            >
              <mat-icon>navigate_before</mat-icon>
            </button>
          </div>
          <div><h2>請留下您的聯絡資料</h2></div>
          <div>
            <button
              type="button"
              mat-fab
              class="next"
              matStepperNext
              [disabled]="secondFormGroup.invalid"
              (click)="updateTourPlan()"
              matTooltip="下一步"
            >
              <mat-icon>navigate_next</mat-icon>
            </button>
          </div>
        </div>
        <form [formGroup]="secondFormGroup">
          <br /><br />
          <div class="contact-control">
            <ygg-contact-control
              formControlName="contact"
            ></ygg-contact-control>
          </div>
        </form>
      </div>
    </mat-step>
    <mat-step>
      <div step="3" class="step3">
        <div
          fxLayout="row"
          fxLayoutAlign="space-between center"
          fxLayoutGap="10px"
        >
          <div>
            <button
              type="button"
              mat-fab
              class="previous"
              matStepperPrevious
              matTooltip="上一步"
            >
              <mat-icon>navigate_before</mat-icon>
            </button>
          </div>
          <div>
            <h2>
              體驗項目選單
            </h2>
          </div>
          <div>
            <button
              type="button"
              mat-fab
              class="next"
              matStepperNext
              matTooltip="下一步"
              (click)="updateTourPlan()"
            >
              <mat-icon>navigate_next</mat-icon>
            </button>
          </div>
        </div>
        <div class="shopping-cart-editor">
          <ygg-shopping-cart-editor
            [formControl]="formControlPurchases"
          ></ygg-shopping-cart-editor>
        </div>
      </div>
    </mat-step>
    <mat-step [stepControl]="forthFormGroup">
      <div step="4" class="step4">
        <div
          fxLayout="row"
          fxLayoutAlign="space-between center"
          fxLayoutGap="10px"
        >
          <div>
            <button
              type="button"
              mat-fab
              class="previous"
              matStepperPrevious
              matTooltip="上一步"
            >
              <mat-icon>navigate_before</mat-icon>
            </button>
          </div>
          <div><h2>其他需求事項</h2></div>
          <div>
            <button
              type="button"
              mat-fab
              class="next"
              [disabled]="forthFormGroup.invalid"
              (click)="toStepPreview()"
              matStepperNext
              matTooltip="下一步"
            >
              <mat-icon>navigate_next</mat-icon>
            </button>
          </div>
        </div>
        <form [formGroup]="forthFormGroup">
          <div class="tour-plan-name">
            <mat-form-field>
              <input matInput placeholder="遊程名稱" formControlName="name" />
            </mat-form-field>
          </div>
          <hr />
          <div class="optional-editor">
            <the-thing-cells-editor
              formControlName="optionalCells"
              [cellsOrder]="imitation.cellsOrder"
            ></the-thing-cells-editor>
          </div>
        </form>
      </div>
    </mat-step>
    <mat-step>
      <div step="5" class="step5">
        <div
          fxLayout="row"
          fxLayoutAlign="space-between center"
          fxLayoutGap="10px"
        >
          <div>
            <button
              type="button"
              mat-fab
              class="previous"
              matStepperPrevious
              matTooltip="上一步"
            >
              <mat-icon>navigate_before</mat-icon>
            </button>
          </div>
          <div>
            <h2>
              預覽並送出遊程規劃
            </h2>
          </div>
          <div>
            <button
              type="button"
              mat-fab
              class="submit"
              matTooltip="儲存遊程規劃"
              [disabled]="!isValidTourPlan()"
              (click)="submitTourPlan()"
            >
              <mat-icon>save</mat-icon>
            </button>
          </div>
        </div>
        <div class="preview">
          <ygg-tour-plan-view
            [theThing$]="theThingPreview$"
          ></ygg-tour-plan-view>
        </div>
      </div>
    </mat-step>
  </mat-horizontal-stepper>
</div>
