<div class="tour-plan-view" *ngIf="theThing">
  <div
    *ngIf="!readonly"
    fxLayout="row"
    fxLayoutAlign="end center"
    fxLayoutGap="10px"
  >
    <button
      type="button"
      mat-fab
      class="save"
      matTooltip="儲存遊程規劃"
      [disabled]="!isValidTourPlan()"
      (click)="save()"
    >
      <mat-icon>save</mat-icon>
    </button>
  </div>
  <div fxLayout="row" fxLayoutAlign="end start" fxLayoutGap="10px"></div>
  <ygg-control-view-switch [readonly]="readonly" class="tour-plan-name">
    <div control>
      <mat-form-field>
        <input
          matInput
          placeholder="請輸入遊程名稱"
          [formControl]="formControlName"
        />
      </mat-form-field>
    </div>
    <div view>
      <h1>{{ formControlName.value }}</h1>
    </div>
  </ygg-control-view-switch>
  <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
    <div>
      <h4 class="state">{{ stateLabel }}</h4>
    </div>
    <div *ngIf="canSubmitApplication && !readonly">
      <button
        mat-mini-fab
        class="submit-application"
        (click)="submitApplication()"
      >
        <mat-icon>send</mat-icon>
      </button>
    </div>
    <div *ngIf="canCancelApplied && !readonly">
      <button
        mat-mini-fab
        class="cancel-applied"
        (click)="cancelApplied()"
        matTooltip="取消此遊程申請"
      >
        <mat-icon>backspace</mat-icon>
      </button>
    </div>
    <div *ngIf="isAdmin && !readonly" [ngSwitch]="state">
      <div *ngSwitchCase="states.applied">
        <button
          mat-mini-fab
          class="admin-paid"
          (click)="adminPaid()"
          matTooltip="標記此遊程已付款完成"
        >
          <mat-icon>payment</mat-icon>
        </button>
      </div>
      <div *ngSwitchCase="states.paid">
        <button
          mat-mini-fab
          class="admin-complete"
          (click)="adminComplete()"
          matTooltip="標記此遊程已全部完成"
        >
          <mat-icon>done_all</mat-icon>
        </button>
      </div>
      <div *ngSwitchDefault></div>
    </div>
  </div>
  <div *ngFor="let cell of requiredCells">
    <div [attr.cell-name]="cell.name">
      <h4>{{ cell.name }}</h4>
      <the-thing-cell-view
        [cell]="cell"
        [editable]="!readonly"
      ></the-thing-cell-view>
      <!-- <the-thing-cell-view [cell]="cell"></the-thing-cell-view> -->
    </div>
  </div>
  <!-- <div class="date-range">
    <h4>預計出遊日期</h4>
    <ygg-date-range-view [dateRange]="dateRange"></ygg-date-range-view>
  </div> -->
  <!-- <div class="day-time-range">
    <h4>預計出遊時段</h4>
    <ygg-day-time-range-view
      [dayTimeRange]="dayTimeRange"
    ></ygg-day-time-range-view>
  </div> -->
  <!-- <div class="num-participants">
    <h4>預計參加人數</h4>
    <div>
      <mat-icon>people</mat-icon>
      <span class="number">{{ numParticipants }}</span>
    </div>
  </div> -->
  <!-- <div class="contact">
    <h4>聯絡資訊</h4>
    <ygg-contact-view [contact]="contact"></ygg-contact-view>
  </div> -->
  <br /><br />

  <div class="purchases">
    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
      <div>
        <h2>預訂品項</h2>
      </div>
      <div *ngIf="!readonly">
        <button
          mat-mini-fab
          class="goto-edit-purchases"
          (click)="gotoEditPurchases()"
        >
          <mat-icon>edit</mat-icon>
        </button>
      </div>
    </div>
    <ygg-purchase-list [purchases]="purchases"></ygg-purchase-list>
  </div>
  <div class="optional-cells">
    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
      <h2>
        其他需求事項
      </h2>
      <div *ngIf="!readonly">
        <button mat-mini-fab class="add-cell" (click)="addCell()">
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>
    <div *ngFor="let cell of getOptionalCells()">
      <div [attr.cell-name]="cell.name" *ngIf="cell.value">
        <h4>{{ cell.name }}</h4>
        <the-thing-cell-view [cell]="cell"></the-thing-cell-view>
      </div>
    </div>
  </div>
</div>
