<div class="ygg-schedule-form">
  <form [formGroup]="formGroup">
    <mat-tab-group>
      <mat-tab label="填寫需求">
        <mat-accordion>
          <mat-expansion-panel expanded>
            <mat-expansion-panel-header>
              <ygg-title-divider
                [style.color]="formGroup.get('dateRange').invalid ? 'red' : ''"
                >預計日期範圍＊</ygg-title-divider
              >
            </mat-expansion-panel-header>
            <div class="form-control">
              <ygg-date-range-picker
                formControlName="dateRange"
              ></ygg-date-range-picker>
              <mat-error *ngIf="isError('dateRange', 'required')"
                >請填日期範圍</mat-error
              >
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <ygg-title-divider
                [style.color]="
                  formGroup.get('numParticipants').invalid ? 'red' : ''
                "
                >預計參加人數＊</ygg-title-divider
              >
            </mat-expansion-panel-header>
            <div class="form-control">
              <ygg-number-slider
                formControlName="numParticipants"
                icon="person"
              ></ygg-number-slider>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <ygg-title-divider>預算</ygg-title-divider>
            </mat-expansion-panel-header>
            <div class="form-control">
              <mat-radio-group
                [(ngModel)]="budgetType"
                [ngModelOptions]="{ standalone: true }"
              >
                <div
                  fxLayout="row"
                  fxLayoutAlign="start center"
                  fxLayoutGap="20px"
                >
                  <mat-radio-button [value]="'total'">總和</mat-radio-button>
                  <mat-radio-button [value]="'single'">單人</mat-radio-button>
                </div>
              </mat-radio-group>
              <br />
              <div>
                <div *ngIf="budgetType === 'total'">
                  <ygg-number-range-control
                    formControlName="totalBudget"
                    [globalMax]="100000"
                    icon="monetization_on"
                  ></ygg-number-range-control>
                </div>
                <div *ngIf="budgetType === 'single'">
                  <ygg-number-range-control
                    formControlName="singleBudget"
                    [globalMax]="10000"
                    icon="monetization_on"
                  ></ygg-number-range-control>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <ygg-title-divider>聯絡資料</ygg-title-divider>
            </mat-expansion-panel-header>
            <div>
              <mat-form-field style="width:100%;">
                <input
                  matInput
                  placeholder="公司行號或團體名稱"
                  formControlName="groupName"
                />
                <span matPrefix><mat-icon>group</mat-icon></span>
              </mat-form-field>
            </div>
            <div formArrayName="contacts" class="form-control">
              <div
                *ngFor="
                  let contactControl of contactsFormArray.controls;
                  let idx = index
                "
              >
                <div
                  fxLayout="row"
                  fxLayoutAlign="space-between end"
                  fxLayoutGap="20px"
                >
                  <h4>聯絡人{{ idx + 1 }}</h4>
                  <button
                    mat-mini-fab
                    (click)="deleteContact(idx)"
                    matTooltip="刪除聯絡人"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
                <ygg-contact-form [formControlName]="idx"></ygg-contact-form>
                <mat-divider> </mat-divider>
              </div>
              <br />
              <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="20px">
                <button
                  mat-mini-fab
                  (click)="addContact()"
                  matTooltip="增加一位聯絡人"
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <ygg-title-divider>交通工具</ygg-title-divider>
            </mat-expansion-panel-header>
            <div class="form-control">
              <div>
                <mat-checkbox
                  [(ngModel)]="needTranspotationHelp"
                  [ngModelOptions]="{ standalone: true }"
                  >請幫我安排交通</mat-checkbox
                >
              </div>
              <br />
              <br />
              <br />
              <div *ngIf="needTranspotationHelp" class="needTranspotationHelp">
                <mat-form-field>
                  <textarea
                    matInput
                    placeholder="請詳述交通的需求，以便我們的工作人員幫忙安排"
                    formControlName="transpotationHelp"
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="10"
                  ></textarea>
                </mat-form-field>
              </div>
              <div *ngIf="!needTranspotationHelp">
                <mat-radio-group formControlName="transpotation">
                  <div
                    fxLayout="row"
                    fxLayoutAlign="space-around center"
                    fxLayoutGap="20px"
                  >
                    <mat-radio-button [value]="'bus'">遊覽車</mat-radio-button>
                    <mat-radio-button [value]="'car'"
                      >自行開車</mat-radio-button
                    >
                  </div>
                </mat-radio-group>
                <br />
                <mat-form-field style="width:100%;">
                  <input
                    matInput
                    placeholder="其他"
                    formControlName="transpotation"
                  />
                </mat-form-field>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <ygg-title-divider>其它需求</ygg-title-divider>
            </mat-expansion-panel-header>
            <div class="form-control">
              <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="50px"
              >
                <div>
                  <ygg-number-slider
                    label="65歲以上人數"
                    formControlName="numElders"
                    icon="https://img.icons8.com/ios/50/000000/elderly-person.png"
                  ></ygg-number-slider>
                </div>
                <div>
                  <ygg-number-slider
                    label="孩童人數"
                    formControlName="numKids"
                    icon="child_care"
                  ></ygg-number-slider>
                </div>
              </div>
              <br /><br />
              <div class="needAccommodationHelp">
                <mat-checkbox
                  [(ngModel)]="needAccommodationHelp"
                  [ngModelOptions]="{ standalone: true }"
                  >請幫我安排住宿</mat-checkbox
                >
                <br />
                <mat-form-field>
                  <textarea
                    matInput
                    [disabled]="!needAccommodationHelp"
                    placeholder="請詳述住宿需求，以便我們的工作人員幫忙安排"
                    formControlName="accommodationHelp"
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="10"
                  ></textarea>
                </mat-form-field>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-tab>
      <mat-tab label="挑選體驗">
        <ygg-resource-selector multi (selectChange)='onSelectResources($event)'></ygg-resource-selector>
      </mat-tab>
    </mat-tab-group>
  </form>
  <div class="debug">
    <pre>{{ formGroup.value | json }}</pre>
  </div>
</div>
